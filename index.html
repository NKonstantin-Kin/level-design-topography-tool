<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Level Design Tool</title>
    <style>
        body { margin:0; overflow:hidden; font-family:Arial; }
        #app { display:flex; flex-direction:column; height:100vh; }
        #toolbar { background:#f0f0f0; padding:8px; display:flex; gap:8px; }
        #canvas-container { flex:1; position:relative; overflow:auto; background:#f9f9f9; }
        canvas { display:block; background:white; box-shadow:0 0 5px rgba(0,0,0,0.1); }
        .resize-handle {
            position:absolute; width:8px; height:8px; background:#1a73e8;
            border-radius:50%; transform:translate(-50%,-50%); cursor:nwse-resize;
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="toolbar">
            <button id="select-btn">Select</button>
            <button id="rect-btn">Rectangle</button>
            <button id="copy-btn">Copy (Ctrl+C)</button>
            <button id="paste-btn">Paste (Ctrl+V)</button>
        </div>
        <div id="canvas-container">
            <canvas id="main-canvas"></canvas>
        </div>
    </div>

    <script>
        // Инициализация canvas
        const canvas = document.getElementById('main-canvas');
        const ctx = canvas.getContext('2d');
        let shapes = [];
        let selectedShape = null;
        let isDragging = false;
        let dragOffset = { x:0, y:0 };
        let resizeHandle = null;
        let clipboard = null;
        
        // Размеры canvas
        function initCanvas() {
            const container = document.getElementById('canvas-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // Класс фигуры
        class Shape {
            constructor(x, y, width, height) {
                this.id = Date.now() + Math.random().toString(36).substr(2,5);
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = '#000000';
                this.handles = [
                    { pos:'nw', x:0, y:0 }, { pos:'n', x:0.5, y:0 }, 
                    { pos:'ne', x:1, y:0 }, { pos:'e', x:1, y:0.5 },
                    { pos:'se', x:1, y:1 }, { pos:'s', x:0.5, y:1 },
                    { pos:'sw', x:0, y:1 }, { pos:'w', x:0, y:0.5 }
                ];
            }
            
            draw() {
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
                
                // Рисуем маркеры трансформации если фигура выделена
                if (selectedShape === this) {
                    this.handles.forEach(handle => {
                        const hx = this.x + handle.x * this.width;
                        const hy = this.y + handle.y * this.height;
                        ctx.fillStyle = '#1a73e8';
                        ctx.beginPath();
                        ctx.arc(hx, hy, 4, 0, Math.PI*2);
                        ctx.fill();
                    });
                }
            }
            
            contains(x, y) {
                return x >= this.x && x <= this.x + this.width &&
                       y >= this.y && y <= this.y + this.height;
            }
            
            getHandleAt(x, y) {
                for (const handle of this.handles) {
                    const hx = this.x + handle.x * this.width;
                    const hy = this.y + handle.y * this.height;
                    if (Math.abs(hx - x) < 8 && Math.abs(hy - y) < 8) {
                        return handle.pos;
                    }
                }
                return null;
            }
        }
        
        // Отрисовка всех фигур
        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            shapes.forEach(shape => shape.draw());
        }
        
        // Обработчики событий
        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Проверяем клик по маркеру трансформации
            if (selectedShape) {
                resizeHandle = selectedShape.getHandleAt(x, y);
                if (resizeHandle) {
                    isDragging = true;
                    return;
                }
            }
            
            // Выбор фигуры
            selectedShape = null;
            for (let i = shapes.length-1; i >= 0; i--) {
                if (shapes[i].contains(x, y)) {
                    selectedShape = shapes[i];
                    isDragging = true;
                    dragOffset = { x: x - selectedShape.x, y: y - selectedShape.y };
                    break;
                }
            }
            
            render();
        }
        
        function handleMouseMove(e) {
            if (!isDragging) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (resizeHandle) {
                // Изменение размера
                const oldWidth = selectedShape.width;
                const oldHeight = selectedShape.height;
                
                switch(resizeHandle) {
                    case 'nw':
                        selectedShape.width += selectedShape.x - x;
                        selectedShape.height += selectedShape.y - y;
                        selectedShape.x = x;
                        selectedShape.y = y;
                        break;
                    case 'n':
                        selectedShape.height += selectedShape.y - y;
                        selectedShape.y = y;
                        break;
                    case 'ne':
                        selectedShape.width = x - selectedShape.x;
                        selectedShape.height += selectedShape.y - y;
                        selectedShape.y = y;
                        break;
                    case 'e':
                        selectedShape.width = x - selectedShape.x;
                        break;
                    case 'se':
                        selectedShape.width = x - selectedShape.x;
                        selectedShape.height = y - selectedShape.y;
                        break;
                    case 's':
                        selectedShape.height = y - selectedShape.y;
                        break;
                    case 'sw':
                        selectedShape.width += selectedShape.x - x;
                        selectedShape.height = y - selectedShape.y;
                        selectedShape.x = x;
                        break;
                    case 'w':
                        selectedShape.width += selectedShape.x - x;
                        selectedShape.x = x;
                        break;
                }
                
                // Минимальный размер
                if (selectedShape.width < 10) selectedShape.width = 10;
                if (selectedShape.height < 10) selectedShape.height = 10;
            } else if (selectedShape) {
                // Перемещение
                selectedShape.x = x - dragOffset.x;
                selectedShape.y = y - dragOffset.y;
            }
            
            render();
        }
        
        function handleMouseUp() {
            isDragging = false;
            resizeHandle = null;
        }
        
        // Копирование/вставка
        function copySelected() {
            if (selectedShape) {
                clipboard = {
                    x: selectedShape.x + 20,
                    y: selectedShape.y + 20,
                    width: selectedShape.width,
                    height: selectedShape.height,
                    color: selectedShape.color
                };
            }
        }
        
        function paste() {
            if (clipboard) {
                const newShape = new Shape(
                    clipboard.x,
                    clipboard.y,
                    clipboard.width,
                    clipboard.height
                );
                newShape.color = clipboard.color;
                shapes.push(newShape);
                selectedShape = newShape;
                render();
            }
        }
        
        // Инициализация
        function init() {
            initCanvas();
            
            // Создаем тестовую фигуру
            const rect = new Shape(100, 100, 150, 100);
            shapes.push(rect);
            
            // Обработчики событий
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            window.addEventListener('resize', initCanvas);
            
            // Кнопки инструментов
            document.getElementById('rect-btn').addEventListener('click', () => {
                const rect = new Shape(50, 50, 150, 100);
                shapes.push(rect);
                selectedShape = rect;
                render();
            });
            
            document.getElementById('select-btn').addEventListener('click', () => {
                selectedShape = null;
                render();
            });
            
            document.getElementById('copy-btn').addEventListener('click', copySelected);
            document.getElementById('paste-btn').addEventListener('click', paste);
            
            // Горячие клавиши
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'c') copySelected();
                if (e.ctrlKey && e.key === 'v') paste();
                if (e.key === 'Delete' && selectedShape) {
                    shapes = shapes.filter(s => s !== selectedShape);
                    selectedShape = null;
                    render();
                }
            });
            
            render();
        }
        
        init();
    </script>
</body>
</html>
